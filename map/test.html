<!DOCTYPE html>
<html>
   
   <head>
      <script src = "https://maps.googleapis.com/maps/api/js?v=3.42&key=AIzaSyBoY4Yn60USF1fDNIm65QVpRBowNeBBgbA&libraries=places"></script>
      <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
      <script src="https://unpkg.com/axios/dist/axios.min.js"></script>
   </head>
   
   <body onload="initMap()">
      <div id = "map" style = "width:580px; height:400px;"></div>
   </body>

   <script>
      let map;
      let markers = [];

      function initMap() {
         const haightAshbury = { lat: 37.769, lng: -122.446 };
         map = new google.maps.Map(document.getElementById("map"), {
            zoom: 12,
            center: haightAshbury,
            mapTypeId: "terrain",
         });
         // This event listener will call addMarker() when the map is clicked.
         map.addListener("click", (event) => {
            addMarker(event.latLng);
         });
         // Adds a marker at the center of the map.
         // addMarker(haightAshbury);
      }

      // Adds a marker to the map and push to the array.
      function addMarker(location) {
         const marker = new google.maps.Marker({
            position: location,
            map: map,
         });
         markers.push(marker);
         if (markers.length == 2) {
            console.log(location.lat() + " ;; " + location.lng());
            // axios.get("https://maps.googleapis.com/maps/api/directions/json?origin=" + markers[0].position.lat() + ",%20" + markers[0].position.lng() + "&destination=" + markers[1].position.lat() + ",%20" + markers[1].position.lng() + "&key=AIzaSyDI57hkGB_K7Mtp4eFdYiy0mIw68z_1R1Y")
            //    .then(response => {
            //       console.log(response.data);
            //    })
            //    .catch(error => console.error("Error"));
            $.ajax({
               url: "https://maps.googleapis.com/maps/api/directions/json?origin=" + markers[0].position.lat() + ",%20" + markers[0].position.lng() + "&destination=" + markers[1].position.lat() + ",%20" + markers[1].position.lng() + "&key=AIzaSyDI57hkGB_K7Mtp4eFdYiy0mIw68z_1R1Y",
               type: "POST",
               headers: {  
                  "Access-Control-Allow-Origin": "*" ,
                  'Authorization': 'AIzaSyDI57hkGB_K7Mtp4eFdYiy0mIw68z_1R1Y',
                  'contentType': 'application/json',
                  // "Access-Control-Allow-Headers": "Content-Type", 
                  // "Access-Control-Allow-Methods" : "GET, POST, PUT, DELETE, OPTIONS",
                  // "Cross-Origin-Resource-Policy" : "cross-origin",
                  // "Access-Control-Allow-Credentials": " true"
               
               },
               // crossDomain: true,
               dataType: 'jsonp',
               success: function (result) {
                  console.log("OK");
                  console.log(result);
               },
               error: function (error) {
                  console.log("Error");
                  console.log(error);
               }
            });
         }
      }

      // Sets the map on all markers in the array.
      function setMapOnAll(map) {
         for (let i = 0; i < markers.length; i++) {
            markers[i].setMap(map);
         }
      }

      // Removes the markers from the map, but keeps them in the array.
      function clearMarkers() {
         setMapOnAll(null);
      }

      // Shows any markers currently in the array.
      function showMarkers() {
         setMapOnAll(map);
      }

      // Deletes all markers in the array by removing references to them.
      function deleteMarkers() {
         clearMarkers();
         markers = [];
      }
         
      // let markers = [];
      // // function loadMap() {
      
      //    var mapOptions = {
      //       center:new google.maps.LatLng(17.377631, 78.478603),
      //       zoom:5
      //    }
         
      //    var map = new google.maps.Map(document.getElementById("sample"),mapOptions);
         
      //    var marker = new google.maps.Marker({
      //       position: new google.maps.LatLng(17.377631, 78.478603),
      //       map: map,
      //       animation:google.maps.Animation.Drop
      //    });
      // // }

      // google.maps.event.addListener(map, 'click', function(event) {
      //    placeMarker(event.latLng);
      // });

      // function placeMarker(location) {
      //    console.log("place marker: " + location);
      //    var marker = new google.maps.Marker({
      //       position: location,
      //       map: map
      //    });
      // }
   </script>
   
</html>